"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4443],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>_});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),c=p(n),_=a,d=c["".concat(l,".").concat(_)]||c[_]||u[_]||s;return n?r.createElement(d,o(o({ref:t},m),{},{components:n})):r.createElement(d,o({ref:t},m))}));function _(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,o=new Array(s);o[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var p=2;p<s;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},6829:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const s={title:"\u041f\u043e\u0447\u0435\u043c\u0443 \u044f \u043d\u0435 \u043c\u043e\u0433\u0443 \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c?"},o=void 0,i={permalink:"/blog/2014/09/22/django-email",source:"@site/blog/2014-09-22-django-email.md",title:"\u041f\u043e\u0447\u0435\u043c\u0443 \u044f \u043d\u0435 \u043c\u043e\u0433\u0443 \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c?",description:'\u0422\u0430\u043a\u043e\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u043f\u0440\u0438\u0448\u0435\u043b \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u0432 \u0442\u0435\u0445\u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0443. \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0437\u0430\u0445\u043e\u0434\u0438\u0442 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043f\u0430\u0440\u043e\u043b\u044f, \u0432\u0432\u043e\u0434\u0438\u0442 \u0441\u0432\u043e\u0439 email, \u043d\u0430\u0436\u0438\u043c\u0430\u0435\u0442 \u043a\u043d\u043e\u043f\u043a\u0443 "\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c". \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0440\u0430\u0434\u043e\u0441\u0442\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0430\u0435\u0442, \u0447\u0442\u043e email \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d. \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0437\u0430\u0445\u043e\u0434\u0438\u0442 \u0432 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u0432\u0438\u0434\u0438\u0442 \u043f\u0438\u0441\u044c\u043c\u0430, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435\u0434\u043e\u0432\u043e\u043b\u0435\u043d.',date:"2014-09-22T00:00:00.000Z",formattedDate:"September 22, 2014",tags:[],readingTime:2.615,hasTruncateMarker:!0,authors:[],frontMatter:{title:"\u041f\u043e\u0447\u0435\u043c\u0443 \u044f \u043d\u0435 \u043c\u043e\u0433\u0443 \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c?"},prevItem:{title:"Adding flavor-specific tasks to Gradle",permalink:"/blog/2016/01/13/gradle"},nextItem:{title:"Android: \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0421\u041c\u0421",permalink:"/blog/2012/08/14/sms"}},l={authorsImageUrls:[]},p=[],m={toc:p};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,'\u0422\u0430\u043a\u043e\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u043f\u0440\u0438\u0448\u0435\u043b \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u0432 \u0442\u0435\u0445\u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0443. \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0437\u0430\u0445\u043e\u0434\u0438\u0442 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043f\u0430\u0440\u043e\u043b\u044f, \u0432\u0432\u043e\u0434\u0438\u0442 \u0441\u0432\u043e\u0439 email, \u043d\u0430\u0436\u0438\u043c\u0430\u0435\u0442 \u043a\u043d\u043e\u043f\u043a\u0443 "\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c". \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0440\u0430\u0434\u043e\u0441\u0442\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0430\u0435\u0442, \u0447\u0442\u043e email \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d. \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0437\u0430\u0445\u043e\u0434\u0438\u0442 \u0432 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u0432\u0438\u0434\u0438\u0442 \u043f\u0438\u0441\u044c\u043c\u0430, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435\u0434\u043e\u0432\u043e\u043b\u0435\u043d.'),(0,a.kt)("p",null,'\u0414\u0430\u043b\u0435\u0435 \u0441\u043b\u0435\u0434\u0443\u0435\u0442 \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e\u0435:\xa0"\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0432\u0432\u043e\u0434\u0430 email\'\u0430, \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u043f\u0438\u0441\u044c\u043c\u043e \u043d\u0435 \u043f\u043e\u043f\u0430\u043b\u043e \u0432 \u0441\u043f\u0430\u043c". \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u043b\u0438-\u0443\u0431\u0435\u0434\u0438\u043b\u0438\u0441\u044c, \u043d\u0435 \u043f\u043e\u043c\u043e\u0433\u043b\u043e. \u0417\u0430\u0445\u043e\u0436\u0443 \u043d\u0430 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440 - \u043f\u0438\u0441\u044c\u043c\u043e \u0434\u0430\u0436\u0435 \u043d\u0435 \u0431\u044b\u043b\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e.'),(0,a.kt)("p",null,'\u041e\u0442\u0440\u044b\u0432\u0430\u044e\u0441\u044c \u043e\u0442 \u0432\u0441\u0435\u0445 \u0434\u0435\u043b \u0438 \u0431\u0440\u043e\u0441\u0430\u044e\u0441\u044c \u0432 \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435. \u0417\u0430\u0445\u043e\u0436\u0443 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f, \u0432\u0432\u043e\u0436\u0443 \u0441\u0432\u043e\u0439 email - \u0432\u0441\u0435 \u0432 \u043f\u043e\u0440\u044f\u0434\u043a\u0435, \u043f\u0438\u0441\u044c\u043c\u043e \u0441\u043e \u0441\u0441\u044b\u043b\u043a\u043e\u0439 \u043d\u0430 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f \u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0442. \u0412\u0432\u043e\u0436\u0443 email \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f - \u0442\u0438\u0448\u0438\u043d\u0430. \u041f\u0438\u0441\u044c\u043c\u043e \u043d\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f. \u0412 \u043b\u043e\u0433\u0435 - \u043d\u0438\u0447\u0435\u0433\u043e (\u043e\u0442 \u0441\u043b\u043e\u0432\u0430 "\u0441\u043e\u0432\u0441\u0435\u043c").'),(0,a.kt)("p",null,"\u0414\u0430\u043b\u0435\u0435 \u0441\u043b\u0435\u0434\u0443\u0435\u0442 \u0441 \u043f\u043e\u043b\u0447\u0430\u0441\u0430 \u0431\u0435\u0441\u043f\u043e\u043b\u0435\u0437\u043d\u044b\u0445 \u043c\u0435\u0442\u0430\u043d\u0438\u0439, \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u043d\u0435\u0434\u043e\u0443\u043c\u0435\u043d\u0438\u044f \u0438 \u043c\u043d\u043e\u0433\u043e \u043d\u0435\u0446\u0435\u043d\u0437\u0443\u0440\u043d\u043e\u0439 \u043b\u0435\u043a\u0441\u0438\u043a\u0438. \u0423\u0441\u043f\u043e\u043a\u0430\u0438\u0432\u0430\u0435\u043c\u0441\u044f, \u0434\u0435\u043b\u0430\u0435\u043c \u0433\u043b\u0443\u0431\u043e\u043a\u0438\u0439 \u0432\u0434\u043e\u0445 \u0438 \u043b\u0435\u0437\u0435\u043c \u0432 \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043a\u043e\u0434 Django."),(0,a.kt)("p",null,"\u0417\u0430 \u0441\u0431\u0440\u043e\u0441 \u043f\u0430\u0440\u043e\u043b\u044f \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 ",(0,a.kt)("inlineCode",{parentName:"p"},"password_reset"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"@csrf_protect\ndef password_reset(request, is_admin_site=False,\n                   template_name='registration/password_reset_form.html',\n                   email_template_name='registration/password_reset_email.html',\n                   subject_template_name='registration/password_reset_subject.txt',\n                   password_reset_form=PasswordResetForm,\n                   token_generator=default_token_generator,\n                   post_reset_redirect=None,\n                   from_email=None,\n                   current_app=None,\n                   extra_context=None):\n    if post_reset_redirect is None:\n        post_reset_redirect = reverse('password_reset_done')\n    else:\n        post_reset_redirect = resolve_url(post_reset_redirect)\n    if request.method == \"POST\":\n        form = password_reset_form(request.POST)\n        if form.is_valid():\n            opts = {\n                'use_https': request.is_secure(),\n                'token_generator': token_generator,\n                'from_email': from_email,\n                'email_template_name': email_template_name,\n                'subject_template_name': subject_template_name,\n                'request': request,\n            }\n            if is_admin_site:\n                opts = dict(opts, domain_override=request.get_host())\n            form.save(**opts)\n            return HttpResponseRedirect(post_reset_redirect)\n    else:\n        form = password_reset_form()\n    context = {\n        'form': form,\n    }\n    if extra_context is not None:\n        context.update(extra_context)\n    return TemplateResponse(request, template_name, context,\n                            current_app=current_app)\n")),(0,a.kt)("p",null,"\u0420\u0430\u0437 \u0440\u0435\u0434\u0438\u0440\u0435\u043a\u0442 \u043d\u0430 ",(0,a.kt)("inlineCode",{parentName:"p"},"post_reset_redirect")," \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442, \u0437\u043d\u0430\u0447\u0438\u0442, ",(0,a.kt)("inlineCode",{parentName:"p"},"form.save()")," \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f. \u0421\u043c\u043e\u0442\u0440\u0438\u043c, \u0447\u0442\u043e \u0443 \u043d\u0435\u0433\u043e \u043f\u043e\u0434 \u043a\u0430\u043f\u043e\u0442\u043e\u043c:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"def save(self, domain_override=None,\n             subject_template_name='registration/password_reset_subject.txt',\n             email_template_name='registration/password_reset_email.html',\n             use_https=False, token_generator=default_token_generator,\n             from_email=None, request=None):\n        \"\"\"\n        Generates a one-use only link for resetting password and sends to the\n        user.\n        \"\"\"\n        from django.core.mail import send_mail\n        UserModel = get_user_model()\n        email = self.cleaned_data[\"email\"]\n        active_users = UserModel._default_manager.filter(\n            email__iexact=email, is_active=True)\n        for user in active_users:\n            # Make sure that no email is sent to a user that actually has\n            # a password marked as unusable\n            if not user.has_usable_password():\n                continue\n            if not domain_override:\n                current_site = get_current_site(request)\n                site_name = current_site.name\n                domain = current_site.domain\n            else:\n                site_name = domain = domain_override\n            c = {\n                'email': user.email,\n                'domain': domain,\n                'site_name': site_name,\n                'uid': urlsafe_base64_encode(force_bytes(user.pk)),\n                'user': user,\n                'token': token_generator.make_token(user),\n                'protocol': 'https' if use_https else 'http',\n            }\n            subject = loader.render_to_string(subject_template_name, c)\n            # Email subject *must not* contain newlines\n            subject = ''.join(subject.splitlines())\n            email = loader.render_to_string(email_template_name, c)\n            send_mail(subject, email, from_email, [user.email])\n")),(0,a.kt)("p",null,"\u0422\u0443\u0442, \u043a\u043e\u043d\u0435\u0447\u043d\u043e, \u0434\u043e \u043c\u0435\u043d\u044f \u0434\u043e\u0445\u043e\u0434\u0438\u0442. \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0441\u044f \u0447\u0435\u0440\u0435\u0437 \u0412\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435. \u041f\u043e\u0442\u043e\u043c \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u043b email. \u0418 \u043e\u0442\u0432\u044f\u0437\u0430\u043b \u0412\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u0435. \u0418 \u0432\u043e\u0442 \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0447\u0435\u0440\u0435\u0437 \u0412\u041a \u0435\u043c\u0443, \u0442.\u0435. \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e, \u043d\u0430\u0437\u043d\u0430\u0447\u0430\u043b\u0438 ",(0,a.kt)("inlineCode",{parentName:"p"},"set_unusable_password()")," (\u0438\u0431\u043e \u043f\u0430\u0440\u043e\u043b\u044f-\u0442\u043e \u0443 \u043d\u0435\u0433\u043e \u043d\u0435 \u0431\u044b\u043b\u043e)."),(0,a.kt)("p",null,"\u0412\u0435\u0441\u044c \u044d\u0442\u043e\u0442 \u043f\u043e\u0442\u043e\u043a \u044d\u043c\u043e\u0446\u0438\u0439 \u0431\u044b\u043b \u0432\u044b\u0437\u0432\u0430\u043d \u0432\u043e\u0442 \u044d\u0442\u0438\u043c\u0438 \u0441\u0442\u0440\u043e\u043a\u0430\u043c\u0438:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"# Make sure that no email is sent to a user that actually has\n# a password marked as unusable\nif not user.has_usable_password():\n  continue\n")),(0,a.kt)("p",null,"\u0417\u0430\u0447\u0435\u043c? \u041f\u043e\u0447\u0435\u043c\u0443? \u041a\u0442\u043e \u0432\u0438\u043d\u043e\u0432\u0430\u0442? \u041f\u043e\u0447\u0435\u043c\u0443 \u043d\u0435\u043b\u044c\u0437\u044f \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c, \u0435\u0441\u043b\u0438 \u0438\u0437\u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e \u043e\u043d \u043d\u0435 \u0431\u044b\u043b \u0437\u0430\u0434\u0430\u043d? \u0410 \u0433\u043b\u0430\u0432\u043d\u043e\u0435, \u043f\u043e\u0447\u0435\u043c\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u043e\u0431 \u044d\u0442\u043e\u043c \u043d\u0438\u043a\u0430\u043a \u043d\u0435 \u0441\u043e\u043e\u0431\u0449\u0430\u0435\u0442, \u0430, \u0445\u0438\u0445\u0438\u043a\u0430\u044f, \u043f\u0435\u0440\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043d\u0430 ",(0,a.kt)("inlineCode",{parentName:"p"},"post_reset_redirect"),'?! \u041a\u0430\u043a \u0442\u0430\u043c \u0433\u043e\u0432\u043e\u0440\u0438\u0442\u0441\u044f, "\u044f\u0432\u043d\u043e\u0435 \u043b\u0443\u0447\u0448\u0435 \u043d\u0435\u044f\u0432\u043d\u043e\u0433\u043e"?'),(0,a.kt)("p",null,"\u0412 \u043e\u0431\u0449\u0435\u043c, \u0438\u043c\u0435\u0439\u0442\u0435 \u0432 \u0432\u0438\u0434\u0443. \u0418 \u043d\u0435 \u043d\u0430\u0441\u0442\u0443\u043f\u0430\u0439\u0442\u0435 \u043d\u0430 \u044d\u0442\u0438 \u0433\u0440\u0430\u0431\u043b\u0438."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Update:")),(0,a.kt)("p",null,"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0442\u043e\u0432\u0430\u0440\u0438\u0449\u0443 ",(0,a.kt)("a",{parentName:"p",href:"https://habr.com/ru/post/237701/#comment_7992609"},"@zzeus"),":"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Users flagged with an unusable password (see set_unusable_password() aren\u2019t allowed to request a password reset to prevent misuse when using an external authentication source like LDAP. Note that they won\u2019t receive any error message since this would expose their account\u2019s existence but no mail will be sent either.")))}u.isMDXComponent=!0}}]);